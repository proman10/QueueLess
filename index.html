<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QueueLess</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Inter,sans-serif;
  background:#020617;
  color:#e5e7eb;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}

.box{
  width:360px;
  background:#0b1220;
  padding:24px;
  border-radius:18px;
  box-shadow:0 25px 60px rgba(0,0,0,.45);
  text-align:center;
}

input,select{
  width:100%;
  padding:12px;
  margin:8px 0;
  border-radius:12px;
  border:1px solid #1e293b;
  background:#020617;
  color:white;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  font-size:16px;
  font-weight:600;
  margin-top:10px;
  cursor:pointer;
}

.join{
  background:linear-gradient(135deg,#3b82f6,#2563eb);
  color:white;
}

.leave{
  background:#1e293b;
  color:#fca5a5;
}

small{
  color:#94a3b8;
}
</style>
</head>

<body>

<div class="box">
  <h2 id="title">Join Queue</h2>

  <select id="lang">
    <option value="en">English</option>
    <option value="hi">हिंदी</option>
    <option value="te">తెలుగు</option>
  </select>

  <input id="name" placeholder="Full Name">
  <input id="age" type="number" placeholder="Age">
  <button class="join" id="joinBtn">Join Queue</button>
  <button class="leave" onclick="leaveQueue()">Leave Queue</button>

  <p id="token"></p>
  <p id="status"></p>
  <small id="doctor"></small>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyB8qFdxKNjEE1LjaDYcRcGa6OlB_vc_ePo",
  authDomain: "queueless-5a7e6.firebaseapp.com",
  databaseURL: "https://queueless-5a7e6-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "queueless-5a7e6",
  storageBucket: "queueless-5a7e6.firebasestorage.app",
  messagingSenderId: "403169758788",
  appId: "1:403169758788:web:f6e02f17480a629df7f611"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const queueRef = db.ref("queue");
const doctorRef = db.ref("currentDoctor");

let myKey = localStorage.getItem("queueKey");

const texts={
  en:{title:"Join Queue"},
  hi:{title:"कतार में शामिल हों"},
  te:{title:"క్యూలో చేరండి"}
};

document.getElementById("lang").onchange=()=>{
  const l=document.getElementById("lang").value;
  document.getElementById("title").innerText=texts[l].title;
};

document.getElementById("joinBtn").onclick=()=>{
  const name=document.getElementById("name").value.trim();
  const age=document.getElementById("age").value.trim();
  if(!name||!age) return;

  queueRef.push({
    name:name.toLowerCase(),
    displayName:name,
    age:age,
    joinedAt:Date.now()
  }).then(ref=>{
    myKey=ref.key;
    localStorage.setItem("queueKey",myKey);
  });
};

function leaveQueue(){
  if(myKey){
    queueRef.child(myKey).remove();
    localStorage.removeItem("queueKey");
    myKey=null;
  }
}

queueRef.on("value",snap=>{
  if(!myKey) return;
  const data=snap.val();
  if(!data||!data[myKey]){
    document.getElementById("status").innerText="You have been served.";
    document.getElementById("token").innerText="";
    return;
  }
  const sorted=Object.entries(data)
    .sort((a,b)=>a[1].joinedAt - b[1].joinedAt);
  const index=sorted.findIndex(e=>e[0]===myKey);
  const token=index+1;

  document.getElementById("token").innerText="Token: "+token;
  document.getElementById("status").innerText=
    token>5?"Please wait":
    token>2?"You are almost there":
    token===2?"You’re next":
    "You are being served now";
});

doctorRef.on("value",snap=>{
  const d=snap.val();
  document.getElementById("doctor").innerText =
    d ? "Doctor: "+d : "";
});
</script>
</body>
</html>
