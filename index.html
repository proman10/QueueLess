<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QueueLess ‚Äì Join Queue</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #020617;
      color: white;
      text-align: center;
      padding-top: 60px;
    }
    .box {
      background: #1e293b;
      padding: 20px;
      border-radius: 12px;
      width: 320px;
      margin: auto;
    }
    input, button, select {
      padding: 10px;
      width: 90%;
      margin-top: 10px;
      border-radius: 8px;
      border: none;
    }
    button {
      background: #3b82f6;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    .info {
      margin-top: 15px;
      font-size: 14px;
    }
  </style>
</head>
<body>

<div class="box">
  <!-- üåç Language Selector -->
  <select id="languageSelect" onchange="changeLanguage()">
    <option value="en">English</option>
    <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
    <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
  </select>

  <h2 id="titleText">Join Queue</h2>
  <p id="instructionText">Enter your full name and age</p>

  <input id="nameInput" placeholder="Full Name">
  <input id="ageInput" type="number" placeholder="Age">

  <button onclick="joinQueue()" id="joinBtn">Join Queue</button>

  <p id="tokenInfo"></p>

  <div class="info">
    <p id="nowServing">Now serving: ‚Äî</p>
    <p id="estimate">Estimated waiting time: ‚Äî</p>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyB8qFdxKNjEE1LjaDYcRcGa6OlB_vc_ePo",
    authDomain: "queueless-5a7e6.firebaseapp.com",
    databaseURL: "https://queueless-5a7e6-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "queueless-5a7e6",
    storageBucket: "queueless-5a7e6.firebasestorage.app",
    messagingSenderId: "403169758788",
    appId: "1:403169758788:web:f6e02f17480a629df7f611"
  };

  firebase.initializeApp(firebaseConfig);
  const queueRef = firebase.database().ref("queue");

  let myToken = null;

  // üåç Language texts
  const texts = {
    en: {
      title: "Join Queue",
      instruction: "Enter your full name and age",
      join: "Join Queue",
      serving: "Now serving",
      estimate: "Estimated waiting time",
      done: "Your turn is done ‚úî"
    },
    hi: {
      title: "‡§ï‡§§‡§æ‡§∞ ‡§Æ‡•á‡§Ç ‡§ú‡•Å‡§°‡§º‡•á‡§Ç",
      instruction: "‡§Ö‡§™‡§®‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§â‡§Æ‡•ç‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
      join: "‡§ï‡§§‡§æ‡§∞ ‡§Æ‡•á‡§Ç ‡§ú‡•Å‡§°‡§º‡•á‡§Ç",
      serving: "‡§Ö‡§≠‡•Ä ‡§∏‡•á‡§µ‡§æ ‡§Æ‡•á‡§Ç",
      estimate: "‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®‡§ø‡§§ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§∏‡§Æ‡§Ø",
      done: "‡§Ü‡§™‡§ï‡•Ä ‡§¨‡§æ‡§∞‡•Ä ‡§™‡•Ç‡§∞‡•Ä ‡§π‡•ã ‡§ó‡§à ‚úî"
    },
    te: {
      title: "‡∞ï‡±ç‡∞Ø‡±Ç‡∞≤‡±ã ‡∞ö‡±á‡∞∞‡∞Ç‡∞°‡∞ø",
      instruction: "‡∞Æ‡±Ä ‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞ø ‡∞™‡±á‡∞∞‡±Å ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞µ‡∞Ø‡∞∏‡±Å ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
      join: "‡∞ï‡±ç‡∞Ø‡±Ç‡∞≤‡±ã ‡∞ö‡±á‡∞∞‡∞Ç‡∞°‡∞ø",
      serving: "‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§‡∞Ç ‡∞∏‡±á‡∞µ‡∞≤‡±ã",
      estimate: "‡∞Ö‡∞Ç‡∞ö‡∞®‡∞æ ‡∞µ‡±á‡∞ö‡∞ø ‡∞â‡∞Ç‡∞°‡±á ‡∞∏‡∞Æ‡∞Ø‡∞Ç",
      done: "‡∞Æ‡±Ä ‡∞µ‡∞Ç‡∞§‡±Å ‡∞™‡±Ç‡∞∞‡±ç‡∞§‡±à‡∞Ç‡∞¶‡∞ø ‚úî"
    }
  };

  let currentLang = "en";

  function changeLanguage() {
    const lang = document.getElementById("languageSelect").value;
    currentLang = lang;

    document.getElementById("titleText").innerText = texts[lang].title;
    document.getElementById("instructionText").innerText = texts[lang].instruction;
    document.getElementById("joinBtn").innerText = texts[lang].join;

    document.getElementById("nowServing").innerText =
      texts[lang].serving + ": ‚Äî";
    document.getElementById("estimate").innerText =
      texts[lang].estimate + ": ‚Äî";
  }

  function joinQueue() {
    const nameRaw = document.getElementById("nameInput").value.trim();
    const age = document.getElementById("ageInput").value.trim();

    if (!nameRaw || !age) {
      alert("Enter name and age");
      return;
    }

    const normalizedName = nameRaw.toLowerCase();

    queueRef.once("value")
      .then(snapshot => {
        const data = snapshot.val() || {};

        // üö´ duplicate check
        for (let token in data) {
          if (
            data[token].name === normalizedName &&
            String(data[token].age) === String(age)
          ) {
            alert("You are already in the queue");
            return;
          }
        }

        const token = Object.keys(data).length + 1;

        return queueRef.child(token).set({
          name: normalizedName,
          displayName: nameRaw,
          age: age,
          status: "waiting"
        }).then(() => {
          myToken = token;
          document.getElementById("tokenInfo").innerText =
            "Your token number is: " + token;

          document.getElementById("nameInput").value = "";
          document.getElementById("ageInput").value = "";
        });
      });
  }

  // üîÑ Live queue updates
  queueRef.on("value", snapshot => {
    const data = snapshot.val();

    if (!data) {
      document.getElementById("nowServing").innerText =
        texts[currentLang].serving + ": ‚Äî";
      document.getElementById("estimate").innerText =
        texts[currentLang].estimate + ": ‚Äî";
      return;
    }

    const tokens = Object.keys(data);
    document.getElementById("nowServing").innerText =
      texts[currentLang].serving + ": Token " + tokens[0];

    if (myToken) {
      const position = tokens.indexOf(String(myToken));
      if (position >= 0) {
        document.getElementById("estimate").innerText =
          texts[currentLang].estimate + ": " + (position * 5) + " minutes";
      } else {
        document.getElementById("estimate").innerText =
          texts[currentLang].done;
      }
    }
  });
</script>

</body>
</html>
