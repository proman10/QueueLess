<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QueueLess â€“ Admin</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Inter,sans-serif;
  background:#020617;
  color:#e5e7eb;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}

.panel{
  width:420px;
  background:#0b1220;
  padding:24px;
  border-radius:18px;
  box-shadow:0 25px 60px rgba(0,0,0,.45);
}

h2{
  margin:0 0 16px;
  text-align:center;
  color:#e0f2fe;
}

input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid #1e293b;
  background:#020617;
  color:white;
  margin-bottom:10px;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  background:linear-gradient(135deg,#22c55e,#16a34a);
  color:white;
}

.qr{
  text-align:center;
  margin:20px 0;
}

.qr img{
  background:white;
  padding:8px;
  border-radius:12px;
}

.now{
  background:#020617;
  padding:14px;
  border-radius:12px;
  margin-bottom:12px;
  text-align:center;
  color:#93c5fd;
  font-weight:600;
}

ul{
  list-style:none;
  padding:0;
  margin:0;
}

li{
  padding:8px;
  border-bottom:1px solid #1e293b;
}
</style>
</head>

<body>

<div class="panel">
  <h2>Admin Panel</h2>

  <input id="doctorInput" placeholder="Doctor Name (e.g. Dr. Sharma)">
  <button onclick="saveDoctor()">Save Doctor</button>

  <div class="qr">
    <p>Scan to join queue</p>
    <img id="qr" width="180">
  </div>

  <div class="now" id="nowServing">No one is being served</div>
  <ul id="queueList"></ul>

  <button onclick="nextPerson()">Next Patient</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyB8qFdxKNjEE1LjaDYcRcGa6OlB_vc_ePo",
  authDomain: "queueless-5a7e6.firebaseapp.com",
  databaseURL: "https://queueless-5a7e6-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "queueless-5a7e6",
  storageBucket: "queueless-5a7e6.firebasestorage.app",
  messagingSenderId: "403169758788",
  appId: "1:403169758788:web:f6e02f17480a629df7f611"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const queueRef = db.ref("queue");
const doctorRef = db.ref("currentDoctor");

const USER_URL = "https://proman10.github.io/QueueLess/index.html";
document.getElementById("qr").src =
  "https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=" +
  encodeURIComponent(USER_URL);

function saveDoctor(){
  const name = document.getElementById("doctorInput").value.trim();
  doctorRef.set(name);
}

function nextPerson(){
  queueRef.once("value", snap=>{
    const data = snap.val();
    if(!data) return;
    const sorted = Object.entries(data)
      .sort((a,b)=>a[1].joinedAt - b[1].joinedAt);
    queueRef.child(sorted[0][0]).remove();
  });
}

queueRef.on("value", snap=>{
  const now = document.getElementById("nowServing");
  const list = document.getElementById("queueList");
  list.innerHTML="";

  const data = snap.val();
  if(!data){
    now.innerText="No one is being served";
    return;
  }

  const sorted = Object.values(data)
    .sort((a,b)=>a.joinedAt - b.joinedAt);

  now.innerText="Now serving: "+sorted[0].displayName;

  sorted.forEach((p,i)=>{
    const li=document.createElement("li");
    li.innerText=(i+1)+". "+p.displayName+" (Age "+p.age+")";
    list.appendChild(li);
  });
});
</script>
</body>
</html>
