<!DOCTYPE html>
<html>
<head>
  <title>QueueLess</title>

  <style>
    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(180deg, #0f172a, #020617);
      font-family: system-ui, -apple-system, Segoe UI, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #e5e7eb;
    }

    .box {
      background: #0b1220;
      width: 100%;
      max-width: 420px;
      padding: 26px;
      border-radius: 18px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.45);
      text-align: center;
    }

    h2 {
      margin-top: 0;
      color: #e0f2fe;
    }

    input {
      width: 100%;
      padding: 14px;
      margin-top: 12px;
      border-radius: 10px;
      border: 1px solid #1e293b;
      background: #020617;
      color: white;
      font-size: 15px;
    }

    button {
      width: 100%;
      padding: 14px;
      margin-top: 18px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
    }

    #token {
      margin-top: 20px;
      font-size: 18px;
      font-weight: 700;
      color: #93c5fd;
    }

    #status {
      margin-top: 8px;
      font-size: 14px;
      color: #e5e7eb;
    }
  </style>
</head>

<body>

<div class="box">
  <h2>Join Queue</h2>

  <input id="name" placeholder="Full Name">
  <input id="age" type="number" placeholder="Age">
  <button id="joinBtn">Join Queue</button>

  <p id="token"></p>
  <p id="status"></p>
</div>

<!-- ðŸ”¥ YOUR SCRIPT â€“ UNTOUCHED -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyB8qFdxKNjEE1LjaDYcRcGa6OlB_vc_ePo",
  authDomain: "queueless-5a7e6.firebaseapp.com",
  databaseURL: "https://queueless-5a7e6-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "queueless-5a7e6",
  storageBucket: "queueless-5a7e6.firebasestorage.app",
  messagingSenderId: "403169758788",
  appId: "1:403169758788:web:f6e02f17480a629df7f611"
};

firebase.initializeApp(firebaseConfig);
const queueRef = firebase.database().ref("queue");

const nameInput = document.getElementById("name");
const ageInput = document.getElementById("age");
const joinBtn = document.getElementById("joinBtn");
const tokenEl = document.getElementById("token");
const statusEl = document.getElementById("status");

let myKey = localStorage.getItem("queueKey");

joinBtn.addEventListener("click", joinQueue);

function joinQueue() {
  const rawName = nameInput.value.trim();
  const ageVal = ageInput.value.trim();
  if (!rawName || !ageVal) {
    statusEl.innerText = "Please enter name and age.";
    return;
  }

  const cleanName = rawName.toLowerCase();

  queueRef.once("value", snap => {
    const data = snap.val();
    if (data) {
      for (let k in data) {
        if (data[k].name === cleanName && data[k].age === ageVal) {
          myKey = k;
          localStorage.setItem("queueKey", myKey);
          return;
        }
      }
    }

    const ref = queueRef.push({
      name: cleanName,
      displayName: rawName,
      age: ageVal,
      joinedAt: Date.now()
    });

    myKey = ref.key;
    localStorage.setItem("queueKey", myKey);
  });
}

queueRef.on("value", snap => {
  if (!myKey) return;

  const data = snap.val();
  if (!data || !data[myKey]) {
    tokenEl.innerText = "";
    statusEl.innerText = "You have been served.";
    localStorage.removeItem("queueKey");
    return;
  }

  const sorted = Object.entries(data)
    .sort((a,b) => a[1].joinedAt - b[1].joinedAt);

  const index = sorted.findIndex(e => e[0] === myKey);
  const tokenNo = index + 1;

  tokenEl.innerText = "Your Token Number: " + tokenNo;

  if (tokenNo > 5) {
    statusEl.innerText = "Please wait. Your turn will come.";
  } else if (tokenNo > 2) {
    statusEl.innerText = "You are almost there.";
  } else if (tokenNo === 2) {
    statusEl.innerText = "Youâ€™re next. Please be ready.";
  } else {
    statusEl.innerText = "You are being served now.";
  }
});
</script>

</body>
</html>
